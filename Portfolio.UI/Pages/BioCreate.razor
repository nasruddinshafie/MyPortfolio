@page "/bio/create"
@attribute [Authorize]
@using Portfolio.UI.Services
@using Portfolio.UI.Components.Bio
@using Portfolio.UI.Models
@inject IBioService BioService
@inject NavigationManager Navigation

<PageTitle>Create Bio</PageTitle>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-plus"></i> Create Your Bio</h3>
                </div>
                <div class="card-body">
                    @if (errorMessage != null)
                    {
                        <div class="alert alert-danger">
                            <h6>Error Creating Bio</h6>
                            <p>@errorMessage</p>
                        </div>
                    }
                    
                    <BioForm Model="@formModel" 
                             OnSubmitCallback="@HandleSubmit" 
                             OnCancelCallback="@HandleCancel"
                             SubmitButtonText="Create Bio"
                             IsSubmitting="@isSubmitting" />
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private BioFormModel formModel = new();
    private bool isSubmitting = false;
    private string? errorMessage;

    private async Task HandleSubmit(BioFormModel model)
    {
        try
        {
            isSubmitting = true;
            errorMessage = null;
            
            var createDto = model.ToCreateDto();
            await BioService.CreateBioAsync(createDto);
            
            Navigation.NavigateTo("/", true);
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        finally
        {
            isSubmitting = false;
        }
    }

    private Task HandleCancel()
    {
        Navigation.NavigateTo("/");
        return Task.CompletedTask;
    }
}